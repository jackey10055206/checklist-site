<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>專案清單與子 Agent 計畫</title>
  <meta name="description" content="公開友善的專案進度看板：Strapi + Next.js 上傳站、審核流程、部署與安全。" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <main class="container">
    <header class="header">
      <div>
        <h1>專案清單與子 Agent 計畫</h1>
        <p class="subtitle">公開安全的專案進度看板（由 JSON 讀取進度，不包含任何敏感資訊）。</p>
        <div class="kv" aria-label="project meta">
          <span class="pill"><strong>技術：</strong> Strapi（CMS）+ Next.js（上傳/審核入口）</span>
          <span class="pill"><strong>重點：</strong> 帳號權限、審核流程、部署與安全</span>
          <span class="pill"><strong>最後更新：</strong> <span id="lastUpdated">—</span></span>
        </div>
      </div>
      <div class="badges" aria-label="legend">
        <span class="badge"><span class="status done" aria-hidden="true"></span> 已完成</span>
        <span class="badge"><span class="status inprogress" aria-hidden="true"></span> 進行中</span>
        <span class="badge"><span class="status" aria-hidden="true"></span> 待辦</span>
        <span class="badge"><span class="status blocked" aria-hidden="true"></span> 卡住</span>
      </div>
    </header>

    <section class="grid" aria-label="overview">
      <article class="card">
        <h2>怎麼看這頁</h2>
        <div class="callout">
          <strong>目標：</strong> 把 Strapi 需要改的地方、上傳站（Next.js）需要做的事情、審核/發布流程、以及部署/安全策略，都集中在同一頁，方便對外同步進度。
        </div>
        <ol class="ul">
          <li>先看 <strong>狀態表</strong>：目前做到哪、卡在哪。</li>
          <li>各區塊可以展開 <strong>詳細任務</strong>：包含驗收標準與注意事項。</li>
          <li>用 <strong>子 Agent 計畫</strong> 把工作切開並行，並在下方活動紀錄追蹤進度。</li>
        </ol>
        <p class="small">提醒：此頁設計為可公開（不包含任何帳密、內網連結或敏感資訊）。</p>
      </article>

      <aside class="card">
        <h2>快速連結</h2>
        <ul class="ul">
          <li><a href="#status">狀態表</a></li>
          <li><a href="#strapi">Strapi 調整</a></li>
          <li><a href="#next">上傳站（Next.js：帳號/權限）</a></li>
          <li><a href="#review">審核流程</a></li>
          <li><a href="#deploy">部署與安全</a></li>
          <li><a href="#subagents">子 Agent 計畫</a></li>
          <li><a href="#activity">活動紀錄</a></li>
        </ul>
        <h3>篩選</h3>
        <div class="filters" role="group" aria-label="filters">
          <label>
            狀態
            <select id="statusFilter">
              <option value="all">全部</option>
              <option value="todo">待辦</option>
              <option value="inprogress">進行中</option>
              <option value="done">已完成</option>
              <option value="blocked">卡住</option>
            </select>
          </label>
          <label>
            搜尋
            <input id="q" type="search" placeholder="搜尋任務（標題 / 負責人 / 備註）…" />
          </label>
        </div>
        <p class="small">篩選只會影響「狀態表」。</p>
      </aside>
    </section>

    <section id="status" class="section">
      <h2>狀態表</h2>
      <div class="table-wrap" aria-label="status table">
        <table id="statusTable">
          <thead>
            <tr>
              <th style="width:14%">區域</th>
              <th style="width:22%">任務</th>
              <th style="width:14%">負責</th>
              <th style="width:12%">狀態</th>
              <th style="width:38%">備註 / 驗收標準（公開安全）</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows are rendered from ./data/progress.json by app.js -->
          </tbody>
        </table>
      </div>
      <p class="small">此表格由 <code>data/progress.json</code> 渲染。要更新進度/負責人/狀態，只要改那個檔案即可。</p>
    </section>

    <section id="strapi" class="section">
      <h2>Strapi 調整</h2>

      <details class="details" open>
        <summary>
          <span>1) Content types & relations</span>
          <span class="meta">Deliverable: schema checklist</span>
        </summary>
        <ul class="ul">
          <li>Define a primary content type (example): <code>Submission</code> with fields: title, description, submitter identity ref, status, timestamps.</li>
          <li>Model uploaded assets: via Strapi Media Library and/or external object storage references.</li>
          <li>Store review metadata: reviewer, decision, notes, decision timestamp, change history.</li>
          <li>Plan for versioning: keep a record of what was approved/published.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>2) Permissions & roles (least privilege)</span>
          <span class="meta">Deliverable: roles matrix</span>
        </summary>
        <ul class="ul">
          <li><strong>Submitter</strong>: create submissions, view own submissions, upload assets, cannot publish.</li>
          <li><strong>Reviewer</strong>: view all submitted items, add review notes, approve/reject.</li>
          <li><strong>Admin</strong>: manage users/roles, override, configure plugins, deployment env.</li>
          <li>Prefer explicit permission grants; avoid “super user” accounts for daily use.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>3) API surface & tokens</span>
          <span class="meta">Deliverable: API contract</span>
        </summary>
        <ul class="ul">
          <li>Decide which endpoints are used by Next app (REST/GraphQL) and which are internal-only.</li>
          <li>Use server-to-server credentials only on the server (never in browser JS).</li>
          <li>Document required scopes for each operation (create submission, upload, list review queue, update status).</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>4) Storage strategy</span>
          <span class="meta">Deliverable: storage decision</span>
        </summary>
        <ul class="ul">
          <li>Choose local vs S3-compatible storage for media assets.</li>
          <li>If external storage: use private buckets + signed URLs + upload size limits.</li>
          <li>Define retention and deletion policies for rejected/expired submissions.</li>
        </ul>
      </details>
    </section>

    <section id="activity" class="section">
      <h2>活動紀錄</h2>
      <div class="card" id="activityLog"></div>
      <p class="small">公開安全的紀錄：只記「決策/進度/子 agent 任務」，不包含內網連結或任何憑證。</p>
    </section>

    <section id="next" class="section">
      <h2>上傳站（Next.js：帳號 / 權限）</h2>

      <details class="details" open>
        <summary>
          <span>1) Authentication approach</span>
          <span class="meta">Deliverable: chosen approach + rationale</span>
        </summary>
        <ul class="ul">
          <li>Pick an auth model: email magic link, OAuth (Google/Microsoft), or SSO/SAML (enterprise).</li>
          <li>Ensure sessions are httpOnly cookies; protect against CSRF where applicable.</li>
          <li>Clarify identity source of truth: IdP vs Strapi Users & Permissions plugin.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>2) Role mapping & authorization</span>
          <span class="meta">Deliverable: mapping rules</span>
        </summary>
        <ul class="ul">
          <li>Map authenticated users to roles (submitter/reviewer/admin).</li>
          <li>Enforce authorization server-side (API routes / server actions) and double-check at Strapi layer.</li>
          <li>Hide UI affordances for unauthorized actions, but never rely only on UI gating.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>3) Upload flow</span>
          <span class="meta">Deliverable: end-to-end upload spec</span>
        </summary>
        <ul class="ul">
          <li>Decide: direct-to-storage upload (preferred for large files) vs proxy through Next server.</li>
          <li>Validate: type/size, malware scanning hook (if needed), filename normalization.</li>
          <li>Show: progress, retries, and clear error messages.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>4) Reviewer experience</span>
          <span class="meta">Deliverable: review queue UI</span>
        </summary>
        <ul class="ul">
          <li>Queue list: filters by status/date/submitter.</li>
          <li>Detail view: preview assets, add internal notes, approve/reject with reason codes.</li>
          <li>Audit trail: show history of decisions and changes.</li>
        </ul>
      </details>
    </section>

    <section id="review" class="section">
      <h2>審核流程</h2>

      <details class="details" open>
        <summary>
          <span>1) State machine</span>
          <span class="meta">Deliverable: states + transitions</span>
        </summary>
        <ul class="ul">
          <li>Define canonical states: <code>draft</code>, <code>submitted</code>, <code>in_review</code>, <code>approved</code>, <code>rejected</code>, <code>published</code>.</li>
          <li>Specify transitions and who can perform them.</li>
          <li>Ensure state changes are atomic (avoid double-approval races).</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>2) Notifications & SLAs</span>
          <span class="meta">Deliverable: notification rules</span>
        </summary>
        <ul class="ul">
          <li>Notify reviewers on new submissions; notify submitters on decision.</li>
          <li>Optional: reminders on aging items.</li>
          <li>Keep notification content generic (don’t leak private data into email).</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>3) Publishing boundaries</span>
          <span class="meta">Deliverable: publish policy</span>
        </summary>
        <ul class="ul">
          <li>Decide what “published” means: visible on a public site, or available to an internal audience.</li>
          <li>Require approvals before publish if needed.</li>
          <li>Record who published and when.</li>
        </ul>
      </details>
    </section>

    <section id="deploy" class="section">
      <h2>部署與安全</h2>

      <details class="details" open>
        <summary>
          <span>A) Public checklist hosting (this page)</span>
          <span class="meta">Deliverable: pick provider + domain</span>
        </summary>
        <ul class="ul">
          <li>Host as static files on: Cloudflare Pages / Vercel / Netlify / GitHub Pages.</li>
          <li>Use a custom domain (e.g. <code>checklist.example.com</code>), HTTPS enforced.</li>
          <li>No environment variables required for this static page.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>B) App hosting (Next + Strapi)</span>
          <span class="meta">Deliverable: architecture choice</span>
        </summary>
        <ul class="ul">
          <li>Next: Vercel/Netlify/Cloudflare Pages (if compatible) or a container platform.</li>
          <li>Strapi: typically container/VM (needs DB + storage); ensure backups, patching, and restricted admin access.</li>
          <li>Use separate environments: dev / staging / prod.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>C) Security baseline</span>
          <span class="meta">Deliverable: hardening checklist</span>
        </summary>
        <ul class="ul">
          <li>Restrict Strapi admin with IP allowlist or SSO gateway.</li>
          <li>Enable rate limiting; apply WAF protections where available.</li>
          <li>Use private object storage + signed URLs; scan uploads if risk requires it.</li>
          <li>Logging: auth events, role changes, review actions; define retention.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>D) Public vs private: recommended safest choices</span>
          <span class="meta">Deliverable: decision record</span>
        </summary>
        <ul class="ul">
          <li><strong>Public checklist:</strong> Cloudflare Pages (simple static hosting) is a strong default.</li>
          <li><strong>Private checklist:</strong> Cloudflare Pages + <strong>Cloudflare Access</strong> (SSO gate) is typically the safest and simplest to operate.</li>
          <li>If using Vercel/Netlify: use their auth/gating options or front with Cloudflare Access when possible.</li>
        </ul>
      </details>

      <article class="card" style="margin-top:12px">
        <h3>Custom domain: safe public hosting options (summary)</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Provider</th>
                <th>Best for</th>
                <th>Custom domain</th>
                <th>Private access</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Cloudflare Pages</td>
                <td>Static sites + tight security controls</td>
                <td>Yes</td>
                <td>Excellent via Cloudflare Access</td>
                <td>Great default if your DNS is on Cloudflare already.</td>
              </tr>
              <tr>
                <td>Vercel</td>
                <td>Next.js apps</td>
                <td>Yes</td>
                <td>Possible (varies); often easiest via external gate</td>
                <td>Best DX for Next. For private-only pages, evaluate gating carefully.</td>
              </tr>
              <tr>
                <td>Netlify</td>
                <td>Static + JAMstack</td>
                <td>Yes</td>
                <td>Possible via add-ons / edge / external gate</td>
                <td>Solid choice; enterprise features vary by plan.</td>
              </tr>
              <tr>
                <td>GitHub Pages</td>
                <td>Open-source/public docs</td>
                <td>Yes</td>
                <td>Not ideal (public by default)</td>
                <td>Great for public content; not a privacy boundary by itself.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="small">For private/internal checklists, prefer an access gateway (e.g. Cloudflare Access) over “security by obscurity”.</p>
      </article>
    </section>

    <section id="subagents" class="section">
      <h2>子 Agent 計畫</h2>
      <div id="agentsDynamic" class="agents"></div>
      <p class="small">上面的卡片由 <code>data/progress.json</code> 渲染；下方可展開的內容是參考模板（之後可逐步中文化/精簡）。</p>

      <hr class="sep" />

      <h3>參考模板（可選）</h3>
      <p class="small">每個子 agent 都應該產出可快速驗收的成果（文件/清單/PR）。</p>

      <details class="details" open>
        <summary>
          <span>Sub-agent A — Strapi schema & permissions</span>
          <span class="meta">Goal: define CMS shape + access model</span>
        </summary>
        <ul class="ul">
          <li><strong>Goals:</strong> propose content types, relations, and role permissions matrix.</li>
          <li><strong>Deliverables:</strong>
            <ul class="ul">
              <li>Schema outline: entities + fields + relationships.</li>
              <li>Roles matrix: submitter/reviewer/admin permissions per endpoint/content type.</li>
              <li>Storage recommendation: local vs S3-compatible, plus signed URL approach.</li>
            </ul>
          </li>
          <li><strong>Done when:</strong> the team can implement Strapi types without ambiguity.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>Sub-agent B — Next auth & role mapping</span>
          <span class="meta">Goal: secure authentication + authorization plan</span>
        </summary>
        <ul class="ul">
          <li><strong>Goals:</strong> pick auth strategy and specify how roles are derived and enforced.</li>
          <li><strong>Deliverables:</strong>
            <ul class="ul">
              <li>Auth decision doc (options + recommendation).</li>
              <li>Threat model notes: session security, CSRF, role escalation risks.</li>
              <li>API boundary: what runs server-side vs client-side.</li>
            </ul>
          </li>
          <li><strong>Done when:</strong> implementers have a clear “how we log in and authorize” spec.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>Sub-agent C — Upload flow & validation</span>
          <span class="meta">Goal: reliable uploads + safe file handling</span>
        </summary>
        <ul class="ul">
          <li><strong>Goals:</strong> specify upload architecture (direct-to-storage vs proxy), validation, and scanning hooks.</li>
          <li><strong>Deliverables:</strong>
            <ul class="ul">
              <li>Upload sequence diagram (text-based is fine).</li>
              <li>Validation rules + limits (size/type/rate).</li>
              <li>Error handling UX checklist.</li>
            </ul>
          </li>
          <li><strong>Done when:</strong> there’s a clear safe path for large files and failures.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>Sub-agent D — Review workflow & auditability</span>
          <span class="meta">Goal: state machine + reviewer UX</span>
        </summary>
        <ul class="ul">
          <li><strong>Goals:</strong> define states, transitions, notifications, and audit trail requirements.</li>
          <li><strong>Deliverables:</strong>
            <ul class="ul">
              <li>State machine spec + transition permissions.</li>
              <li>Reviewer queue requirements and edge cases (race conditions, re-review, overrides).</li>
              <li>Audit log fields and retention guidance.</li>
            </ul>
          </li>
          <li><strong>Done when:</strong> “who can do what when” is unambiguous.</li>
        </ul>
      </details>

      <details class="details">
        <summary>
          <span>Sub-agent E — Deployment & security posture</span>
          <span class="meta">Goal: choose hosting + protective controls</span>
        </summary>
        <ul class="ul">
          <li><strong>Goals:</strong> propose deployment topology for Next + Strapi + DB + storage; define access restrictions.</li>
          <li><strong>Deliverables:</strong>
            <ul class="ul">
              <li>Environment plan: dev/staging/prod separation.</li>
              <li>Access controls: protect Strapi admin (SSO gateway/IP allowlist), WAF/rate-limits.</li>
              <li>Backup/restore plan (RPO/RTO assumptions, at a high level).</li>
            </ul>
          </li>
          <li><strong>Done when:</strong> team can proceed with infra without revisiting basics.</li>
        </ul>
      </details>
    </section>

    <footer class="footer">
      <p>This is a standalone static page. It contains no secrets and is suitable for public hosting.</p>
      <p>To update: edit <code>index.html</code> (tasks, owners, statuses) and redeploy.</p>
    </footer>
  </main>

  <script src="./app.js" defer></script>
</body>
</html>
